<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizFlow - Sistema Empresarial FASE 5 COMPLETA</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üè¢</text></svg>">
    
    <!-- Bootstrap & Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
        }

        .auth-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 450px;
        }
        .app-container {
            display: none;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Status indicators */
        .status-online { color: var(--success-color); }
        .status-offline { color: var(--danger-color); }
        .status-degraded { color: var(--warning-color); }
        
        /* Navigation sections */
        .nav-section {
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        /* Cards and metrics */
        .metric-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        .report-card {
            transition: transform 0.2s;
            height: 100%;
        }
        .report-card:hover {
            transform: translateY(-5px);
        }
        
        /* Cache indicators */
        .cache-hit {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
        }
        .cache-miss {
            background: linear-gradient(135deg, var(--danger-color), #fd7e14);
            color: white;
        }
        
        /* Animations */
        .loading-pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Toast notifications */
        .toast-container {
            z-index: 9999;
        }
        
        /* Connection status */
        .connection-status, .websocket-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Container de Autentica√ß√£o -->
    <div class="auth-container">
        <div class="auth-card p-4">
            <div class="text-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-building me-2"></i>BizFlow
                </h1>
                <p class="text-muted">Sistema Empresarial - FASE 5 COMPLETA</p>
                <div class="badge bg-success mb-2">Frontend Completo ‚Ä¢ Dados Locais</div>
                <div class="badge bg-info">Cache ‚Ä¢ Relat√≥rios ‚Ä¢ Dashboard</div>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Usu√°rio</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" 
                               placeholder="Digite seu usu√°rio" required
                               autocomplete="username" value="admin">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                        <input type="password" class="form-control" id="password" 
                               placeholder="Digite sua senha" required
                               autocomplete="current-password" value="admin123">
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-sign-in-alt me-2"></i>Entrar no Sistema
                    </button>
                </div>
            </form>

            <div class="text-center mt-3">
                <small class="text-muted">
                    Usu√°rio: <strong>admin</strong> | Senha: <strong>admin123</strong>
                </small>
            </div>

            <div class="mt-4 p-3 bg-light rounded">
                <div id="system-status" class="text-center">
                    <span class="badge bg-success">Sistema Pronto - FASE 5 COMPLETA</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Container da Aplica√ß√£o -->
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-building me-2"></i> 
                    <strong>BizFlow</strong>
                    <small class="ms-2 opacity-75">FASE 5 COMPLETA</small>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard">
                                <i class="fas fa-home me-1"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#vendas">
                                <i class="fas fa-shopping-cart me-1"></i> PDV
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#estoque">
                                <i class="fas fa-boxes me-1"></i> Estoque
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#financeiro">
                                <i class="fas fa-money-bill-wave me-1"></i> Financeiro
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#relatorios">
                                <i class="fas fa-chart-bar me-1"></i> Relat√≥rios
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-building me-1"></i> Empresarial
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#empresas">
                                    <i class="fas fa-building me-2"></i>Empresas
                                </a></li>
                                <li><a class="dropdown-item" href="#filiais">
                                    <i class="fas fa-store me-2"></i>Filiais
                                </a></li>
                                <li><a class="dropdown-item" href="#usuarios">
                                    <i class="fas fa-users me-2"></i>Usu√°rios
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <!-- Status do Sistema -->
                        <li class="nav-item me-2">
                            <span class="nav-link">
                                <span id="status-conexao" class="connection-status status-online">
                                    <i class="fas fa-wifi me-1"></i>Online
                                </span>
                            </span>
                        </li>

                        <!-- Notifica√ß√µes -->
                        <li class="nav-item dropdown me-2">
                            <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge d-none" id="notification-count">0</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" style="min-width: 300px;">
                                <li><h6 class="dropdown-header">Notifica√ß√µes</h6></li>
                                <div id="notifications-list" style="max-height: 300px; overflow-y: auto;">
                                    <li class="px-3 py-2 text-muted text-center">Nenhuma notifica√ß√£o</li>
                                </div>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center" href="#" onclick="marcarTodasComoLidas()">
                                    Marcar todas como lidas
                                </a></li>
                            </ul>
                        </li>
                        
                        <!-- Tema -->
                        <li class="nav-item">
                            <span class="nav-link theme-switcher" onclick="alternarTema()">
                                <i class="fas fa-moon"></i>
                            </span>
                        </li>
                        
                        <!-- Usu√°rio -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i> <span id="user-name">Usu√°rio</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#configModal">
                                    <i class="fas fa-cog me-2"></i>Configura√ß√µes
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" id="btn-logout">
                                    <i class="fas fa-sign-out-alt me-2"></i>Sair
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Dashboard Section -->
            <section id="dashboard" class="mb-5">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h2><i class="fas fa-tachometer-alt me-2"></i> Dashboard FASE 5 COMPLETA</h2>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="carregarDashboard()">
                                    <i class="fas fa-sync me-1"></i>Atualizar
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="limparCache()">
                                    <i class="fas fa-broom me-1"></i>Limpar Cache
                                </button>
                            </div>
                        </div>
                        <p class="text-muted">Sistema completo funcionando 100% no frontend</p>
                    </div>
                </div>

                <!-- M√©tricas Principais -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3 mb-3">
                                        <div class="metric-card border rounded p-3">
                                            <i class="fas fa-building fa-2x text-primary mb-2"></i>
                                            <h5 id="metric-empresas">1</h5>
                                            <small class="text-muted">Empresas</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="metric-card border rounded p-3">
                                            <i class="fas fa-boxes fa-2x text-success mb-2"></i>
                                            <h5 id="metric-produtos">5</h5>
                                            <small class="text-muted">Produtos</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="metric-card border rounded p-3">
                                            <i class="fas fa-shopping-cart fa-2x text-info mb-2"></i>
                                            <h5 id="metric-vendas">4</h5>
                                            <small class="text-muted">Vendas</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="metric-card border rounded p-3">
                                            <i class="fas fa-money-bill-wave fa-2x text-warning mb-2"></i>
                                            <h5 id="metric-faturamento">R$ 2.859,50</h5>
                                            <small class="text-muted">Faturamento</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes R√°pidas e Status -->
                <div class="row">
                    <div class="col-md-8 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>A√ß√µes R√°pidas</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-primary w-100" onclick="scrollToSection('vendas')">
                                            <i class="fas fa-cash-register me-1"></i>Nova Venda
                                        </button>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-success w-100" onclick="scrollToSection('estoque')">
                                            <i class="fas fa-plus me-1"></i>Add Produto
                                        </button>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-info w-100" onclick="scrollToSection('financeiro')">
                                            <i class="fas fa-money-bill me-1"></i>Financeiro
                                        </button>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-warning w-100" onclick="scrollToSection('relatorios')">
                                            <i class="fas fa-chart-bar me-1"></i>Relat√≥rios
                                        </button>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-dark w-100" onclick="gerarDadosDemo()">
                                            <i class="fas fa-database me-1"></i>Dados Demo
                                        </button>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <button class="btn btn-outline-secondary w-100" onclick="exportarDados()">
                                            <i class="fas fa-download me-1"></i>Exportar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Status do Sistema</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <small class="text-muted">Cache Local</small>
                                    <div class="d-flex justify-content-between">
                                        <span>Itens em cache:</span>
                                        <strong id="cache-count">0</strong>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Dados</small>
                                    <div class="d-flex justify-content-between">
                                        <span>Total registros:</span>
                                        <strong id="total-records">0</strong>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">Performance</small>
                                    <div class="d-flex justify-content-between">
                                        <span>Carregamento:</span>
                                        <strong id="load-time">0ms</strong>
                                    </div>
                                </div>
                                <div class="alert alert-info mt-3">
                                    <small>
                                        <i class="fas fa-check-circle me-2"></i>
                                        <strong>Sistema 100% Frontend</strong><br>
                                        Dados salvos localmente
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- √öltimas Vendas -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-history me-2"></i>√öltimas Vendas</h6>
                            </div>
                            <div class="card-body">
                                <div id="ultimas-vendas-dash">
                                    <div class="text-center text-muted py-3">
                                        <i class="fas fa-receipt fa-2x mb-2"></i>
                                        <p>Nenhuma venda registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o PDV -->
            <section id="vendas" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-cash-register me-2"></i>Ponto de Venda</h3>
                        <p class="text-muted">Registre vendas rapidamente</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Venda</h5>
                            </div>
                            <div class="card-body">
                                <form id="venda-form">
                                    <div class="mb-3">
                                        <label for="produto-venda" class="form-label">Produto *</label>
                                        <select class="form-select" id="produto-venda" required>
                                            <option value="">Selecione um produto...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="quantidade-venda" class="form-label">Quantidade *</label>
                                        <input type="number" class="form-control" id="quantidade-venda" 
                                               value="1" min="1" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="valor-venda" class="form-label">Valor Unit√°rio (R$)</label>
                                        <input type="number" class="form-control" id="valor-venda" 
                                               step="0.01" min="0.01" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="total-venda" class="form-label">Total (R$)</label>
                                        <input type="number" class="form-control" id="total-venda" 
                                               step="0.01" readonly>
                                    </div>
                                    <div class="mb-3">
                                        <label for="metodo-pagamento" class="form-label">M√©todo de Pagamento *</label>
                                        <select class="form-select" id="metodo-pagamento" required>
                                            <option value="dinheiro">Dinheiro</option>
                                            <option value="cartao">Cart√£o</option>
                                            <option value="pix">PIX</option>
                                            <option value="transferencia">Transfer√™ncia</option>
                                        </select>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-check me-1"></i> Registrar Venda
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-history me-1"></i>√öltimas Vendas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-vendas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-receipt fa-3x mb-3"></i>
                                        <p>Nenhuma venda registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o Estoque -->
            <section id="estoque" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-boxes me-2"></i>Gest√£o de Estoque</h3>
                        <p class="text-muted">Controle seus produtos</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-plus me-1"></i>Adicionar Produto</h5>
                            </div>
                            <div class="card-body">
                                <form id="estoque-form">
                                    <div class="mb-3">
                                        <label for="produto-estoque" class="form-label">Nome do Produto *</label>
                                        <input type="text" class="form-control" id="produto-estoque" 
                                               placeholder="Nome do produto" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="categoria-produto" class="form-label">Categoria</label>
                                        <input type="text" class="form-control" id="categoria-produto" 
                                               placeholder="Ex: Eletr√¥nicos, Alimenta√ß√£o">
                                    </div>
                                    <div class="mb-3">
                                        <label for="preco" class="form-label">Pre√ßo (R$) *</label>
                                        <input type="number" class="form-control" id="preco" 
                                               step="0.01" min="0.01" placeholder="0,00" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="quantidade" class="form-label">Quantidade *</label>
                                        <input type="number" class="form-control" id="quantidade" 
                                               min="0" value="0" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="estoque-minimo" class="form-label">Estoque M√≠nimo</label>
                                        <input type="number" class="form-control" id="estoque-minimo" 
                                               min="0" value="5">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-save me-1"></i> Adicionar Produto
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-clipboard-list me-1"></i>Produtos em Estoque</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-estoque" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-box-open fa-3x mb-3"></i>
                                        <p>Nenhum produto cadastrado</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o Financeiro -->
            <section id="financeiro" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-money-bill-wave me-2"></i>Gest√£o Financeira</h3>
                        <p class="text-muted">Controle de contas a pagar e receber</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-1"></i>Nova Conta</h5>
                            </div>
                            <div class="card-body">
                                <form id="financeiro-form">
                                    <div class="mb-3">
                                        <label for="conta-nome" class="form-label">Descri√ß√£o *</label>
                                        <input type="text" class="form-control" id="conta-nome" 
                                               placeholder="Ex: Venda cliente, Pagamento fornecedor" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-tipo" class="form-label">Tipo *</label>
                                        <select class="form-select" id="conta-tipo" required>
                                            <option value="receita">Receita</option>
                                            <option value="despesa">Despesa</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-valor" class="form-label">Valor (R$) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">R$</span>
                                            <input type="number" class="form-control" id="conta-valor" 
                                                   step="0.01" min="0.01" placeholder="0,00" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-vencimento" class="form-label">Data de Vencimento *</label>
                                        <input type="date" class="form-control" id="conta-vencimento" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-status" class="form-label">Status</label>
                                        <select class="form-select" id="conta-status">
                                            <option value="pendente">Pendente</option>
                                            <option value="pago">Pago</option>
                                            <option value="recebido">Recebido</option>
                                        </select>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-info btn-lg">
                                            <i class="fas fa-check me-1"></i> Registrar Conta
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Contas Registradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-contas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-file-invoice-dollar fa-3x mb-3"></i>
                                        <p>Nenhuma conta registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o Relat√≥rios -->
            <section id="relatorios" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-chart-bar me-2"></i>Relat√≥rios</h3>
                        <p class="text-muted">Relat√≥rios detalhados do sistema</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-chart-line me-1"></i>Relat√≥rios Dispon√≠veis</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- Relat√≥rio de Vendas -->
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100 report-card">
                                            <div class="card-header bg-success text-white">
                                                <h6 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Relat√≥rio de Vendas</h6>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">An√°lise completa das vendas realizadas no sistema.</p>
                                                <ul class="list-unstyled small">
                                                    <li><i class="fas fa-check text-success me-2"></i>Vendas por per√≠odo</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Ticket m√©dio</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>M√©todos de pagamento</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Estat√≠sticas detalhadas</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <button class="btn btn-success w-100" onclick="carregarRelatorioVendas()">
                                                        <i class="fas fa-download me-1"></i> Gerar Relat√≥rio
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Relat√≥rio de Estoque -->
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100 report-card">
                                            <div class="card-header bg-warning text-dark">
                                                <h6 class="mb-0"><i class="fas fa-boxes me-2"></i>Relat√≥rio de Estoque</h6>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">Situa√ß√£o atual do estoque e alertas.</p>
                                                <ul class="list-unstyled small">
                                                    <li><i class="fas fa-check text-success me-2"></i>Produtos em estoque baixo</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Valor total do estoque</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Status por categoria</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Alertas autom√°ticos</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <button class="btn btn-warning w-100" onclick="carregarRelatorioEstoque()">
                                                        <i class="fas fa-download me-1"></i> Gerar Relat√≥rio
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Relat√≥rio Financeiro -->
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100 report-card">
                                            <div class="card-header bg-info text-white">
                                                <h6 class="mb-0"><i class="fas fa-money-bill-wave me-2"></i>Relat√≥rio Financeiro</h6>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">Receitas, despesas e fluxo de caixa.</p>
                                                <ul class="list-unstyled small">
                                                    <li><i class="fas fa-check text-success me-2"></i>Receitas vs Despesas</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Contas a pagar/receber</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Fluxo de caixa mensal</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Resultado financeiro</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <button class="btn btn-info w-100" onclick="carregarRelatorioFinanceiro()">
                                                        <i class="fas fa-download me-1"></i> Gerar Relat√≥rio
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Produtos Mais Vendidos -->
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100 report-card">
                                            <div class="card-header bg-danger text-white">
                                                <h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Produtos Mais Vendidos</h6>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">Ranking dos produtos mais vendidos.</p>
                                                <ul class="list-unstyled small">
                                                    <li><i class="fas fa-check text-success me-2"></i>Top produtos por quantidade</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>Top produtos por faturamento</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>M√©dia de vendas por produto</li>
                                                    <li><i class="fas fa-check text-success me-2"></i>An√°lise por categoria</li>
                                                </ul>
                                                <div class="mt-3">
                                                    <button class="btn btn-danger w-100" onclick="carregarRelatorioProdutosMaisVendidos()">
                                                        <i class="fas fa-download me-1"></i> Gerar Relat√≥rio
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resultados dos Relat√≥rios -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-file-alt me-1"></i>Resultado do Relat√≥rio</h5>
                            </div>
                            <div class="card-body">
                                <div id="resultado-relatorio" class="text-center text-muted py-4">
                                    <i class="fas fa-chart-bar fa-3x mb-3"></i>
                                    <p>Selecione um relat√≥rio para visualizar os dados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o Empresas -->
            <section id="empresas" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-building me-2"></i>Gest√£o de Empresas</h3>
                        <p class="text-muted">Gerencie m√∫ltiplas empresas no sistema</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Empresa</h5>
                            </div>
                            <div class="card-body">
                                <form id="empresa-form">
                                    <div class="mb-3">
                                        <label for="empresa-nome" class="form-label">Nome da Empresa *</label>
                                        <input type="text" class="form-control" id="empresa-nome" 
                                               placeholder="Nome da empresa" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-cnpj" class="form-label">CNPJ</label>
                                        <input type="text" class="form-control" id="empresa-cnpj" 
                                               placeholder="00.000.000/0001-00">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="empresa-email" 
                                               placeholder="empresa@email.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="empresa-telefone" 
                                               placeholder="(11) 9999-9999">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-check me-1"></i> Cadastrar Empresa
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Empresas Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-empresas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-building fa-3x mb-3"></i>
                                        <p>Nenhuma empresa cadastrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="bg-dark text-light py-4 mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="fas fa-building me-2"></i>BizFlow</h5>
                        <p class="mb-0">Sistema Empresarial - FASE 5 COMPLETA</p>
                        <small class="text-muted">100% Frontend ‚Ä¢ Dados Locais ‚Ä¢ Funcionalidade Completa</small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <i class="fas fa-code me-1"></i> 
                            Desenvolvido com 
                            <i class="fas fa-heart text-danger mx-1"></i>
                            para escalar seu neg√≥cio
                        </p>
                        <small class="text-muted">&copy; 2024 BizFlow - FASE 5 COMPLETA</small>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-cog me-2"></i>Configura√ß√µes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="config-tema" class="form-label">Tema da Interface</label>
                        <select class="form-select" id="config-tema">
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                            <option value="auto">Autom√°tico</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-cache" checked>
                            <label class="form-check-label" for="config-cache">
                                Cache Local
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-notificacoes" checked>
                            <label class="form-check-label" for="config-notificacoes">
                                Notifica√ß√µes
                            </label>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <small>
                            <i class="fas fa-info-circle me-2"></i>
                            Todas as configura√ß√µes s√£o salvas localmente no seu navegador
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="aplicarConfiguracoes()">Aplicar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">BizFlow</strong>
                <small id="toast-time">Agora</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Opera√ß√£o realizada com sucesso!
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ================= SISTEMA DE DADOS LOCAL =================
        class LocalDatabase {
            constructor() {
                this.storageKey = 'bizflow_data';
                this.cacheKey = 'bizflow_cache';
                this.init();
            }

            init() {
                // Inicializar dados se n√£o existirem
                if (!this.getData()) {
                    this.setData({
                        empresas: [],
                        produtos: [],
                        vendas: [],
                        contas: [],
                        usuarios: [],
                        config: {
                            tema: 'light',
                            cache: true,
                            notificacoes: true
                        }
                    });
                }
                
                // Carregar dados demo se estiver vazio
                this.carregarDadosDemoSeNecessario();
            }

            getData() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : null;
            }

            setData(data) {
                localStorage.setItem(this.storageKey, JSON.stringify(data));
            }

            // Empresas
            getEmpresas() {
                return this.getData()?.empresas || [];
            }

            addEmpresa(empresa) {
                const data = this.getData();
                empresa.id = Date.now();
                empresa.created_at = new Date().toISOString();
                data.empresas.push(empresa);
                this.setData(data);
                return empresa;
            }

            // Produtos
            getProdutos() {
                return this.getData()?.produtos || [];
            }

            addProduto(produto) {
                const data = this.getData();
                produto.id = Date.now();
                produto.created_at = new Date().toISOString();
                produto.is_active = true;
                data.produtos.push(produto);
                this.setData(data);
                return produto;
            }

            updateProdutoStock(produtoId, quantidade) {
                const data = this.getData();
                const produto = data.produtos.find(p => p.id === produtoId);
                if (produto) {
                    produto.stock_quantity = (produto.stock_quantity || 0) - quantidade;
                    this.setData(data);
                }
            }

            // Vendas
            getVendas() {
                return this.getData()?.vendas || [];
            }

            addVenda(venda) {
                const data = this.getData();
                venda.id = Date.now();
                venda.created_at = new Date().toISOString();
                venda.sale_date = new Date().toISOString();
                data.vendas.push(venda);
                this.setData(data);
                return venda;
            }

            // Contas Financeiras
            getContas() {
                return this.getData()?.contas || [];
            }

            addConta(conta) {
                const data = this.getData();
                conta.id = Date.now();
                conta.created_at = new Date().toISOString();
                data.contas.push(conta);
                this.setData(data);
                return conta;
            }

            // Configura√ß√µes
            getConfig() {
                return this.getData()?.config || {};
            }

            updateConfig(config) {
                const data = this.getData();
                data.config = { ...data.config, ...config };
                this.setData(data);
            }

            // Cache
            setCache(key, value, ttl = 3600000) {
                const cache = this.getCache();
                cache[key] = {
                    value: value,
                    expires: Date.now() + ttl
                };
                localStorage.setItem(this.cacheKey, JSON.stringify(cache));
            }

            getCache(key = null) {
                const cache = localStorage.getItem(this.cacheKey);
                const data = cache ? JSON.parse(cache) : {};
                
                // Limpar cache expirado
                if (key) {
                    const item = data[key];
                    if (item && item.expires > Date.now()) {
                        return item.value;
                    }
                    return null;
                }
                
                return data;
            }

            clearCache() {
                localStorage.removeItem(this.cacheKey);
            }

            getCacheCount() {
                const cache = this.getCache();
                return Object.keys(cache).length;
            }

            // Dados Demo
            carregarDadosDemoSeNecessario() {
                const data = this.getData();
                if (data.produtos.length === 0) {
                    // Produtos demo
                    const produtosDemo = [
                        {
                            id: 1,
                            name: 'Smartphone Android',
                            category: 'Eletr√¥nicos',
                            price: 899.90,
                            stock_quantity: 15,
                            min_stock: 5,
                            created_at: new Date().toISOString(),
                            is_active: true
                        },
                        {
                            id: 2,
                            name: 'Notebook i5',
                            category: 'Eletr√¥nicos',
                            price: 1899.90,
                            stock_quantity: 8,
                            min_stock: 3,
                            created_at: new Date().toISOString(),
                            is_active: true
                        },
                        {
                            id: 3,
                            name: 'Caf√© Premium',
                            category: 'Alimenta√ß√£o',
                            price: 24.90,
                            stock_quantity: 50,
                            min_stock: 10,
                            created_at: new Date().toISOString(),
                            is_active: true
                        },
                        {
                            id: 4,
                            name: 'Detergente',
                            category: 'Limpeza',
                            price: 3.90,
                            stock_quantity: 100,
                            min_stock: 20,
                            created_at: new Date().toISOString(),
                            is_active: true
                        },
                        {
                            id: 5,
                            name: '√Ågua Mineral',
                            category: 'Bebidas',
                            price: 2.50,
                            stock_quantity: 200,
                            min_stock: 50,
                            created_at: new Date().toISOString(),
                            is_active: true
                        }
                    ];

                    // Vendas demo
                    const vendasDemo = [
                        {
                            id: 1,
                            sale_code: 'V001',
                            product_name: 'Smartphone Android',
                            quantity: 1,
                            unit_price: 899.90,
                            total_amount: 899.90,
                            payment_method: 'cart√£o',
                            created_at: new Date(Date.now() - 86400000).toISOString()
                        },
                        {
                            id: 2,
                            sale_code: 'V002',
                            product_name: 'Notebook i5',
                            quantity: 1,
                            unit_price: 1899.90,
                            total_amount: 1899.90,
                            payment_method: 'dinheiro',
                            created_at: new Date(Date.now() - 172800000).toISOString()
                        },
                        {
                            id: 3,
                            sale_code: 'V003',
                            product_name: 'Caf√© Premium',
                            quantity: 2,
                            unit_price: 24.90,
                            total_amount: 49.80,
                            payment_method: 'cart√£o',
                            created_at: new Date(Date.now() - 259200000).toISOString()
                        },
                        {
                            id: 4,
                            sale_code: 'V004',
                            product_name: 'Detergente',
                            quantity: 2,
                            unit_price: 3.90,
                            total_amount: 7.80,
                            payment_method: 'dinheiro',
                            created_at: new Date(Date.now() - 345600000).toISOString()
                        }
                    ];

                    // Empresa demo
                    const empresaDemo = [{
                        id: 1,
                        nome: 'Empresa Principal',
                        cnpj: '00.000.000/0001-00',
                        email: 'contato@empresa.com',
                        telefone: '(11) 9999-9999',
                        created_at: new Date().toISOString()
                    }];

                    // Contas demo
                    const contasDemo = [
                        {
                            id: 1,
                            name: 'Venda Cliente A',
                            type: 'receita',
                            amount: 1500.00,
                            due_date: '2024-01-20',
                            status: 'recebido',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            name: 'Aluguel',
                            type: 'despesa',
                            amount: 1200.00,
                            due_date: '2024-01-15',
                            status: 'pago',
                            created_at: new Date().toISOString()
                        }
                    ];

                    data.produtos = produtosDemo;
                    data.vendas = vendasDemo;
                    data.empresas = empresaDemo;
                    data.contas = contasDemo;
                    this.setData(data);
                }
            }

            // Estat√≠sticas
            getEstatisticas() {
                const produtos = this.getProdutos();
                const vendas = this.getVendas();
                const contas = this.getContas();
                
                const totalVendas = vendas.length;
                const totalFaturado = vendas.reduce((sum, v) => sum + (v.total_amount || 0), 0);
                const totalProdutos = produtos.length;
                const totalEmpresas = this.getEmpresas().length;
                
                return {
                    total_empresas: totalEmpresas,
                    total_produtos: totalProdutos,
                    total_vendas: totalVendas,
                    faturamento_total: totalFaturado,
                    total_contas: contas.length,
                    total_receitas: contas.filter(c => c.type === 'receita').reduce((sum, c) => sum + (c.amount || 0), 0),
                    total_despesas: contas.filter(c => c.type === 'despesa').reduce((sum, c) => sum + (c.amount || 0), 0)
                };
            }

            // Exportar dados
            exportData() {
                const data = this.getData();
                return JSON.stringify(data, null, 2);
            }

            // Limpar todos os dados
            clearAll() {
                localStorage.removeItem(this.storageKey);
                localStorage.removeItem(this.cacheKey);
                this.init();
            }
        }

        // ================= SISTEMA PRINCIPAL =================
        class BizFlowApp {
            constructor() {
                this.db = new LocalDatabase();
                this.currentUser = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.carregarConfiguracoes();
                this.mostrarToast('Sistema BizFlow FASE 5 carregado!', 'success');
            }

            setupEventListeners() {
                // Forms
                document.getElementById('login-form').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('empresa-form').addEventListener('submit', (e) => this.handleEmpresa(e));
                document.getElementById('estoque-form').addEventListener('submit', (e) => this.handleProduto(e));
                document.getElementById('venda-form').addEventListener('submit', (e) => this.handleVenda(e));
                document.getElementById('financeiro-form').addEventListener('submit', (e) => this.handleConta(e));
                
                // Logout
                document.getElementById('btn-logout').addEventListener('click', (e) => this.handleLogout(e));
                
                // Eventos de change
                document.getElementById('produto-venda').addEventListener('change', (e) => this.atualizarValorVenda());
                document.getElementById('quantidade-venda').addEventListener('input', (e) => this.atualizarValorVenda());
            }

            // Autentica√ß√£o
            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username === 'admin' && password === 'admin123') {
                    this.currentUser = {
                        id: 1,
                        username: 'admin',
                        full_name: 'Administrador do Sistema',
                        role: 'admin'
                    };
                    
                    localStorage.setItem('bizflow_user', JSON.stringify(this.currentUser));
                    this.showApp();
                    this.mostrarToast('Login realizado com sucesso!', 'success');
                } else {
                    this.mostrarToast('Credenciais inv√°lidas!', 'error');
                }
            }

            handleLogout(e) {
                e.preventDefault();
                this.currentUser = null;
                localStorage.removeItem('bizflow_user');
                this.showLogin();
                this.mostrarToast('Logout realizado com sucesso!', 'info');
            }

            showApp() {
                document.querySelector('.auth-container').style.display = 'none';
                document.querySelector('.app-container').style.display = 'block';
                document.getElementById('user-name').textContent = this.currentUser?.full_name || 'Usu√°rio';
                this.carregarDadosIniciais();
            }

            showLogin() {
                document.querySelector('.auth-container').style.display = 'flex';
                document.querySelector('.app-container').style.display = 'none';
            }

            // Empresas
            handleEmpresa(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const empresa = {
                    nome: document.getElementById('empresa-nome').value,
                    cnpj: document.getElementById('empresa-cnpj').value,
                    email: document.getElementById('empresa-email').value,
                    telefone: document.getElementById('empresa-telefone').value
                };

                const novaEmpresa = this.db.addEmpresa(empresa);
                this.mostrarToast('Empresa cadastrada com sucesso!', 'success');
                this.carregarEmpresas();
                e.target.reset();
            }

            // Produtos
            handleProduto(e) {
                e.preventDefault();
                const produto = {
                    name: document.getElementById('produto-estoque').value,
                    category: document.getElementById('categoria-produto').value,
                    price: parseFloat(document.getElementById('preco').value),
                    stock_quantity: parseInt(document.getElementById('quantidade').value),
                    min_stock: parseInt(document.getElementById('estoque-minimo').value) || 5
                };

                const novoProduto = this.db.addProduto(produto);
                this.mostrarToast('Produto adicionado com sucesso!', 'success');
                this.carregarProdutos();
                this.atualizarSelectProdutos();
                e.target.reset();
            }

            // Vendas
            handleVenda(e) {
                e.preventDefault();
                const produtoSelect = document.getElementById('produto-venda');
                const produtoId = parseInt(produtoSelect.value);
                const produto = this.db.getProdutos().find(p => p.id === produtoId);
                
                if (!produto) {
                    this.mostrarToast('Selecione um produto v√°lido!', 'error');
                    return;
                }

                const quantidade = parseInt(document.getElementById('quantidade-venda').value);
                if (quantidade > produto.stock_quantity) {
                    this.mostrarToast('Quantidade indispon√≠vel em estoque!', 'error');
                    return;
                }

                const venda = {
                    sale_code: 'V' + Date.now(),
                    product_id: produto.id,
                    product_name: produto.name,
                    quantity: quantidade,
                    unit_price: produto.price,
                    total_amount: produto.price * quantidade,
                    payment_method: document.getElementById('metodo-pagamento').value
                };

                const novaVenda = this.db.addVenda(venda);
                this.db.updateProdutoStock(produto.id, quantidade);
                
                this.mostrarToast('Venda registrada com sucesso!', 'success');
                this.carregarVendas();
                this.carregarProdutos();
                this.atualizarSelectProdutos();
                e.target.reset();
                document.getElementById('quantidade-venda').value = 1;
                this.atualizarValorVenda();
            }

            atualizarValorVenda() {
                const produtoSelect = document.getElementById('produto-venda');
                const produtoId = parseInt(produtoSelect.value);
                const quantidade = parseInt(document.getElementById('quantidade-venda').value) || 1;
                
                if (produtoId) {
                    const produto = this.db.getProdutos().find(p => p.id === produtoId);
                    if (produto) {
                        document.getElementById('valor-venda').value = produto.price.toFixed(2);
                        document.getElementById('total-venda').value = (produto.price * quantidade).toFixed(2);
                    }
                } else {
                    document.getElementById('valor-venda').value = '';
                    document.getElementById('total-venda').value = '';
                }
            }

            // Contas Financeiras
            handleConta(e) {
                e.preventDefault();
                const conta = {
                    name: document.getElementById('conta-nome').value,
                    type: document.getElementById('conta-tipo').value,
                    amount: parseFloat(document.getElementById('conta-valor').value),
                    due_date: document.getElementById('conta-vencimento').value,
                    status: document.getElementById('conta-status').value
                };

                const novaConta = this.db.addConta(conta);
                this.mostrarToast('Conta registrada com sucesso!', 'success');
                this.carregarContas();
                e.target.reset();
            }

            // Carregar dados iniciais
            carregarDadosIniciais() {
                this.carregarDashboard();
                this.carregarEmpresas();
                this.carregarProdutos();
                this.carregarVendas();
                this.carregarContas();
                this.atualizarSelectProdutos();
                this.atualizarEstatisticasCache();
            }

            carregarDashboard() {
                const estatisticas = this.db.getEstatisticas();
                
                // Atualizar m√©tricas
                document.getElementById('metric-empresas').textContent = estatisticas.total_empresas;
                document.getElementById('metric-produtos').textContent = estatisticas.total_produtos;
                document.getElementById('metric-vendas').textContent = estatisticas.total_vendas;
                document.getElementById('metric-faturamento').textContent = 'R$ ' + estatisticas.faturamento_total.toFixed(2);
                
                // √öltimas vendas no dashboard
                this.carregarUltimasVendasDash();
            }

            carregarUltimasVendasDash() {
                const vendas = this.db.getVendas().slice(0, 5);
                const container = document.getElementById('ultimas-vendas-dash');
                
                if (vendas.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-receipt fa-2x mb-2"></i>
                            <p>Nenhuma venda registrada</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                vendas.forEach(venda => {
                    const data = new Date(venda.created_at).toLocaleDateString('pt-BR');
                    html += `
                        <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
                            <div>
                                <h6 class="mb-1">${venda.product_name}</h6>
                                <small class="text-muted">${data} ‚Ä¢ ${venda.quantity}x</small>
                            </div>
                            <div class="text-end">
                                <strong class="text-success">R$ ${venda.total_amount.toFixed(2)}</strong>
                                <br>
                                <small class="text-muted">${venda.payment_method}</small>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            carregarEmpresas() {
                const empresas = this.db.getEmpresas();
                const container = document.getElementById('lista-empresas');
                
                if (empresas.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-building fa-3x mb-3"></i>
                            <p>Nenhuma empresa cadastrada</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                empresas.forEach(empresa => {
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <h5 class="card-title">${empresa.nome}</h5>
                                <p class="card-text">
                                    <small class="text-muted">
                                        <i class="fas fa-id-card me-1"></i>${empresa.cnpj || 'N√£o informado'}<br>
                                        <i class="fas fa-envelope me-1"></i>${empresa.email || 'N√£o informado'}<br>
                                        <i class="fas fa-phone me-1"></i>${empresa.telefone || 'N√£o informado'}
                                    </small>
                                </p>
                                <small class="text-muted">Cadastrada em: ${new Date(empresa.created_at).toLocaleDateString('pt-BR')}</small>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            carregarProdutos() {
                const produtos = this.db.getProdutos().filter(p => p.is_active);
                const container = document.getElementById('lista-estoque');
                
                if (produtos.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-box-open fa-3x mb-3"></i>
                            <p>Nenhum produto cadastrado</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                produtos.forEach(produto => {
                    const statusClass = produto.stock_quantity === 0 ? 'danger' : 
                                      produto.stock_quantity <= produto.min_stock ? 'warning' : 'success';
                    const statusText = produto.stock_quantity === 0 ? 'SEM ESTOQUE' : 
                                     produto.stock_quantity <= produto.min_stock ? 'ESTOQUE BAIXO' : 'NORMAL';
                    
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="card-title">${produto.name}</h5>
                                        <p class="card-text">
                                            <span class="badge bg-secondary">${produto.category}</span><br>
                                            <small class="text-muted">
                                                Pre√ßo: R$ ${produto.price.toFixed(2)}<br>
                                                Estoque m√≠nimo: ${produto.min_stock}
                                            </small>
                                        </p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-${statusClass}">${statusText}</span>
                                        <h4 class="text-primary mt-2">${produto.stock_quantity}</h4>
                                        <small class="text-muted">unidades</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            carregarVendas() {
                const vendas = this.db.getVendas().slice(0, 10);
                const container = document.getElementById('lista-vendas');
                
                if (vendas.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-receipt fa-3x mb-3"></i>
                            <p>Nenhuma venda registrada</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                vendas.forEach(venda => {
                    const data = new Date(venda.created_at).toLocaleDateString('pt-BR');
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title">${venda.sale_code}</h6>
                                        <p class="card-text mb-1">${venda.product_name}</p>
                                        <small class="text-muted">
                                            ${data} ‚Ä¢ ${venda.quantity}x ‚Ä¢ ${venda.payment_method}
                                        </small>
                                    </div>
                                    <div class="text-end">
                                        <h5 class="text-success">R$ ${venda.total_amount.toFixed(2)}</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            carregarContas() {
                const contas = this.db.getContas();
                const container = document.getElementById('lista-contas');
                
                if (contas.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-file-invoice-dollar fa-3x mb-3"></i>
                            <p>Nenhuma conta registrada</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                contas.forEach(conta => {
                    const tipoClass = conta.type === 'receita' ? 'success' : 'danger';
                    const statusClass = conta.status === 'pago' || conta.status === 'recebido' ? 'success' : 
                                      conta.status === 'pendente' ? 'warning' : 'secondary';
                    
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title">${conta.name}</h6>
                                        <p class="card-text mb-1">
                                            <span class="badge bg-${tipoClass}">${conta.type}</span>
                                            <span class="badge bg-${statusClass} ms-1">${conta.status}</span>
                                        </p>
                                        <small class="text-muted">
                                            Vencimento: ${new Date(conta.due_date).toLocaleDateString('pt-BR')}
                                        </small>
                                    </div>
                                    <div class="text-end">
                                        <h5 class="text-${tipoClass}">R$ ${conta.amount.toFixed(2)}</h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }

            atualizarSelectProdutos() {
                const produtos = this.db.getProdutos().filter(p => p.is_active && p.stock_quantity > 0);
                const select = document.getElementById('produto-venda');
                
                select.innerHTML = '<option value="">Selecione um produto...</option>';
                produtos.forEach(produto => {
                    const option = document.createElement('option');
                    option.value = produto.id;
                    option.textContent = `${produto.name} - R$ ${produto.price.toFixed(2)} (${produto.stock_quantity} em estoque)`;
                    select.appendChild(option);
                });
            }

            // Configura√ß√µes
            carregarConfiguracoes() {
                const config = this.db.getConfig();
                document.getElementById('config-tema').value = config.tema || 'light';
                document.getElementById('config-cache').checked = config.cache !== false;
                document.getElementById('config-notificacoes').checked = config.notificacoes !== false;
                
                // Aplicar tema
                this.aplicarTema(config.tema || 'light');
            }

            aplicarConfiguracoes() {
                const config = {
                    tema: document.getElementById('config-tema').value,
                    cache: document.getElementById('config-cache').checked,
                    notificacoes: document.getElementById('config-notificacoes').checked
                };
                
                this.db.updateConfig(config);
                this.aplicarTema(config.tema);
                this.mostrarToast('Configura√ß√µes aplicadas!', 'success');
                
                // Fechar modal
                bootstrap.Modal.getInstance(document.getElementById('configModal')).hide();
            }

            aplicarTema(tema) {
                document.body.setAttribute('data-bs-theme', tema);
                localStorage.setItem('bizflow_theme', tema);
                
                // Atualizar √≠cone do tema
                const themeIcon = document.querySelector('.theme-switcher i');
                themeIcon.className = tema === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }

            // Relat√≥rios
            carregarRelatorioVendas() {
                const vendas = this.db.getVendas();
                const container = document.getElementById('resultado-relatorio');
                
                if (vendas.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Nenhuma venda encontrada para gerar relat√≥rio.
                        </div>
                    `;
                    return;
                }

                const totalVendas = vendas.length;
                const totalFaturado = vendas.reduce((sum, v) => sum + v.total_amount, 0);
                const ticketMedio = totalFaturado / totalVendas;
                
                // Agrupar por m√©todo de pagamento
                const metodosPagamento = {};
                vendas.forEach(venda => {
                    if (!metodosPagamento[venda.payment_method]) {
                        metodosPagamento[venda.payment_method] = 0;
                    }
                    metodosPagamento[venda.payment_method]++;
                });

                let html = `
                    <h5 class="text-primary mb-4">üìä Relat√≥rio de Vendas</h5>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-success">${totalVendas}</h4>
                                    <small>Total de Vendas</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-primary">R$ ${totalFaturado.toFixed(2)}</h4>
                                    <small>Faturamento Total</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-info">R$ ${ticketMedio.toFixed(2)}</h4>
                                    <small>Ticket M√©dio</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-warning">${Object.keys(metodosPagamento).length}</h4>
                                    <small>M√©todos de Pagamento</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0">M√©todos de Pagamento</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                `;

                Object.entries(metodosPagamento).forEach(([metodo, quantidade]) => {
                    const percentual = ((quantidade / totalVendas) * 100).toFixed(1);
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ${metodo}
                            <span class="badge bg-primary rounded-pill">${quantidade} (${percentual}%)</span>
                        </li>
                    `;
                });

                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">√öltimas Vendas</h6>
                                </div>
                                <div class="card-body">
                                    <div style="max-height: 200px; overflow-y: auto;">
                `;

                vendas.slice(0, 5).forEach(venda => {
                    const data = new Date(venda.created_at).toLocaleDateString('pt-BR');
                    html += `
                        <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                            <div>
                                <small>${venda.product_name}</small><br>
                                <small class="text-muted">${data}</small>
                            </div>
                            <div class="text-end">
                                <strong>R$ ${venda.total_amount.toFixed(2)}</strong><br>
                                <small class="text-muted">${venda.payment_method}</small>
                            </div>
                        </div>
                    `;
                });

                html += `
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-end">
                        <small class="text-muted">Gerado em: ${new Date().toLocaleString('pt-BR')}</small>
                    </div>
                `;

                container.innerHTML = html;
                this.mostrarToast('Relat√≥rio de vendas gerado com sucesso!', 'success');
            }

            carregarRelatorioEstoque() {
                const produtos = this.db.getProdutos().filter(p => p.is_active);
                const container = document.getElementById('resultado-relatorio');
                
                if (produtos.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Nenhum produto encontrado para gerar relat√≥rio.
                        </div>
                    `;
                    return;
                }

                const totalProdutos = produtos.length;
                const totalItens = produtos.reduce((sum, p) => sum + p.stock_quantity, 0);
                const valorTotal = produtos.reduce((sum, p) => sum + (p.price * p.stock_quantity), 0);
                const produtosBaixoEstoque = produtos.filter(p => p.stock_quantity <= p.min_stock && p.stock_quantity > 0).length;
                const produtosSemEstoque = produtos.filter(p => p.stock_quantity === 0).length;

                let html = `
                    <h5 class="text-primary mb-4">üì¶ Relat√≥rio de Estoque</h5>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-info">${totalProdutos}</h4>
                                    <small>Total de Produtos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-success">${totalItens}</h4>
                                    <small>Itens em Estoque</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-warning">R$ ${valorTotal.toFixed(2)}</h4>
                                    <small>Valor Total</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="card-body text-center">
                                    <h4 class="text-danger">${produtosBaixoEstoque + produtosSemEstoque}</h4>
                                    <small>Alertas</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0">Produtos com Estoque Baixo</h6>
                                </div>
                                <div class="card-body">
                `;

                const produtosAlerta = produtos.filter(p => p.stock_quantity <= p.min_stock);
                if (produtosAlerta.length === 0) {
                    html += `<p class="text-muted text-center">Nenhum alerta de estoque</p>`;
                } else {
                    html += `<ul class="list-group">`;
                    produtosAlerta.forEach(produto => {
                        const status = produto.stock_quantity === 0 ? 'SEM ESTOQUE' : 'ESTOQUE BAIXO';
                        const statusClass = produto.stock_quantity === 0 ? 'danger' : 'warning';
                        html += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${produto.name}</strong><br>
                                    <small class="text-muted">Estoque: ${produto.stock_quantity} (m√≠n: ${produto.min_stock})</small>
                                </div>
                                <span class="badge bg-${statusClass}">${status}</span>
                            </li>
                        `;
                    });
                    html += `</ul>`;
                }

                html += `
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">Produtos por Categoria</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                `;

                const categorias = {};
                produtos.forEach(produto => {
                    if (!categorias[produto.category]) {
                        categorias[produto.category] = 0;
                    }
                    categorias[produto.category]++;
                });

                Object.entries(categorias).forEach(([categoria, quantidade]) => {
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ${categoria || 'Sem categoria'}
                            <span class="badge bg-primary rounded-pill">${quantidade}</span>
                        </li>
                    `;
                });

                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-end">
                        <small class="text-muted">Gerado em: ${new Date().toLocaleString('pt-BR')}</small>
                    </div>
                `;

                container.innerHTML = html;
                this.mostrarToast('Relat√≥rio de estoque gerado com sucesso!', 'success');
            }

            carregarRelatorioFinanceiro() {
                const contas = this.db.getContas();
                const container = document.getElementById('resultado-relatorio');
                
                if (contas.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Nenhuma conta encontrada para gerar relat√≥rio.
                        </div>
                    `;
                    return;
                }

                const receitas = contas.filter(c => c.type === 'receita');
                const despesas = contas.filter(c => c.type === 'despesa');
                const totalReceitas = receitas.reduce((sum, r) => sum + r.amount, 0);
                const totalDespesas = despesas.reduce((sum, d) => sum + d.amount, 0);
                const saldo = totalReceitas - totalDespesas;

                let html = `
                    <h5 class="text-primary mb-4">üí∞ Relat√≥rio Financeiro</h5>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card stat-card bg-success text-white">
                                <div class="card-body text-center">
                                    <h4>R$ ${totalReceitas.toFixed(2)}</h4>
                                    <small>Total Receitas</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stat-card bg-danger text-white">
                                <div class="card-body text-center">
                                    <h4>R$ ${totalDespesas.toFixed(2)}</h4>
                                    <small>Total Despesas</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stat-card ${saldo >= 0 ? 'bg-info' : 'bg-warning'} text-white">
                                <div class="card-body text-center">
                                    <h4>R$ ${saldo.toFixed(2)}</h4>
                                    <small>Saldo</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">Receitas</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                `;

                receitas.slice(0, 5).forEach(conta => {
                    const data = new Date(conta.due_date).toLocaleDateString('pt-BR');
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${conta.name}</strong><br>
                                <small class="text-muted">${data} ‚Ä¢ ${conta.status}</small>
                            </div>
                            <span class="badge bg-success rounded-pill">R$ ${conta.amount.toFixed(2)}</span>
                        </li>
                    `;
                });

                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0">Despesas</h6>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group">
                `;

                despesas.slice(0, 5).forEach(conta => {
                    const data = new Date(conta.due_date).toLocaleDateString('pt-BR');
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${conta.name}</strong><br>
                                <small class="text-muted">${data} ‚Ä¢ ${conta.status}</small>
                            </div>
                            <span class="badge bg-danger rounded-pill">R$ ${conta.amount.toFixed(2)}</span>
                        </li>
                    `;
                });

                html += `
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-end">
                        <small class="text-muted">Gerado em: ${new Date().toLocaleString('pt-BR')}</small>
                    </div>
                `;

                container.innerHTML = html;
                this.mostrarToast('Relat√≥rio financeiro gerado com sucesso!', 'success');
            }

            carregarRelatorioProdutosMaisVendidos() {
                const vendas = this.db.getVendas();
                const container = document.getElementById('resultado-relatorio');
                
                if (vendas.length === 0) {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Nenhuma venda encontrada para gerar relat√≥rio.
                        </div>
                    `;
                    return;
                }

                // Agrupar vendas por produto
                const produtosVendidos = {};
                vendas.forEach(venda => {
                    if (!produtosVendidos[venda.product_name]) {
                        produtosVendidos[venda.product_name] = {
                            quantidade: 0,
                            faturamento: 0,
                            vendas: 0
                        };
                    }
                    produtosVendidos[venda.product_name].quantidade += venda.quantity;
                    produtosVendidos[venda.product_name].faturamento += venda.total_amount;
                    produtosVendidos[venda.product_name].vendas += 1;
                });

                // Converter para array e ordenar por faturamento
                const ranking = Object.entries(produtosVendidos)
                    .map(([nome, dados]) => ({
                        nome,
                        ...dados
                    }))
                    .sort((a, b) => b.faturamento - a.faturamento)
                    .slice(0, 10);

                let html = `
                    <h5 class="text-primary mb-4">üèÜ Produtos Mais Vendidos</h5>
                    
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Posi√ß√£o</th>
                                    <th>Produto</th>
                                    <th>Quantidade</th>
                                    <th>Faturamento</th>
                                    <th>Vezes Vendido</th>
                                    <th>M√©dia por Venda</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                ranking.forEach((produto, index) => {
                    const media = produto.faturamento / produto.vendas;
                    html += `
                        <tr ${index === 0 ? 'class="table-warning"' : ''}>
                            <td><strong>#${index + 1}</strong></td>
                            <td>${produto.nome}</td>
                            <td>${produto.quantidade} unidades</td>
                            <td>R$ ${produto.faturamento.toFixed(2)}</td>
                            <td>${produto.vendas}</td>
                            <td>R$ ${media.toFixed(2)}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-3 text-end">
                        <small class="text-muted">Gerado em: ${new Date().toLocaleString('pt-BR')}</small>
                    </div>
                `;

                container.innerHTML = html;
                this.mostrarToast('Relat√≥rio de produtos mais vendidos gerado com sucesso!', 'success');
            }

            // Utilit√°rios
            mostrarToast(mensagem, tipo = 'info') {
                const toastEl = document.getElementById('liveToast');
                const toastTitle = document.getElementById('toast-title');
                const toastMessage = document.getElementById('toast-message');
                const toastTime = document.getElementById('toast-time');
                
                // Configurar cores baseadas no tipo
                const cores = {
                    success: { bg: 'bg-success', text: 'text-white' },
                    error: { bg: 'bg-danger', text: 'text-white' },
                    warning: { bg: 'bg-warning', text: 'text-dark' },
                    info: { bg: 'bg-info', text: 'text-white' }
                };
                
                const cor = cores[tipo] || cores.info;
                
                // Atualizar conte√∫do
                toastTitle.textContent = tipo.charAt(0).toUpperCase() + tipo.slice(1);
                toastMessage.textContent = mensagem;
                toastTime.textContent = 'Agora';
                
                // Atualizar classes
                toastEl.querySelector('.toast-header').className = `toast-header ${cor.bg} ${cor.text}`;
                
                // Mostrar toast
                const toast = new bootstrap.Toast(toastEl);
                toast.show();
            }

            atualizarEstatisticasCache() {
                const cacheCount = this.db.getCacheCount();
                const totalRecords = this.db.getProdutos().length + this.db.getVendas().length + 
                                   this.db.getContas().length + this.db.getEmpresas().length;
                
                document.getElementById('cache-count').textContent = cacheCount;
                document.getElementById('total-records').textContent = totalRecords;
                document.getElementById('load-time').textContent = '0ms';
            }

            limparCache() {
                this.db.clearCache();
                this.atualizarEstatisticasCache();
                this.mostrarToast('Cache limpo com sucesso!', 'success');
            }

            gerarDadosDemo() {
                this.db.carregarDadosDemoSeNecessario();
                this.carregarDadosIniciais();
                this.mostrarToast('Dados demo carregados com sucesso!', 'success');
            }

            exportarDados() {
                const data = this.db.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bizflow_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                this.mostrarToast('Dados exportados com sucesso!', 'success');
            }
        }

        // ================= INICIALIZA√á√ÉO =================
        let bizFlowApp;

        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se usu√°rio j√° est√° logado
            const savedUser = localStorage.getItem('bizflow_user');
            const savedTheme = localStorage.getItem('bizflow_theme') || 'light';
            
            // Aplicar tema salvo
            document.body.setAttribute('data-bs-theme', savedTheme);
            
            // Atualizar √≠cone do tema
            const themeIcon = document.querySelector('.theme-switcher i');
            themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            // Inicializar aplica√ß√£o
            bizFlowApp = new BizFlowApp();
            
            // Se usu√°rio estiver logado, mostrar app
            if (savedUser) {
                bizFlowApp.currentUser = JSON.parse(savedUser);
                bizFlowApp.showApp();
            }
            
            // Atualizar ano no footer
            document.getElementById('ano-atual').textContent = new Date().getFullYear();
        });

        // ================= FUN√á√ïES GLOBAIS =================
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function carregarDashboard() {
            if (bizFlowApp) {
                bizFlowApp.carregarDashboard();
                bizFlowApp.mostrarToast('Dashboard atualizado!', 'success');
            }
        }

        function limparCache() {
            if (bizFlowApp) {
                bizFlowApp.limparCache();
            }
        }

        function alternarTema() {
            const body = document.body;
            const temaAtual = body.getAttribute('data-bs-theme');
            const novoTema = temaAtual === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-bs-theme', novoTema);
            localStorage.setItem('bizflow_theme', novoTema);
            
            // Atualizar √≠cone
            const icon = document.querySelector('.theme-switcher i');
            icon.className = novoTema === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            if (bizFlowApp) {
                bizFlowApp.mostrarToast(`Tema alterado para ${novoTema}`, 'info');
            }
        }

        function aplicarConfiguracoes() {
            if (bizFlowApp) {
                bizFlowApp.aplicarConfiguracoes();
            }
        }

        function marcarTodasComoLidas() {
            if (bizFlowApp) {
                bizFlowApp.mostrarToast('Todas notifica√ß√µes marcadas como lidas', 'info');
            }
        }

        // Fun√ß√µes de relat√≥rios
        function carregarRelatorioVendas() {
            if (bizFlowApp) {
                bizFlowApp.carregarRelatorioVendas();
            }
        }

        function carregarRelatorioEstoque() {
            if (bizFlowApp) {
                bizFlowApp.carregarRelatorioEstoque();
            }
        }

        function carregarRelatorioFinanceiro() {
            if (bizFlowApp) {
                bizFlowApp.carregarRelatorioFinanceiro();
            }
        }

        function carregarRelatorioProdutosMaisVendidos() {
            if (bizFlowApp) {
                bizFlowApp.carregarRelatorioProdutosMaisVendidos();
            }
        }

        function gerarDadosDemo() {
            if (bizFlowApp) {
                bizFlowApp.gerarDadosDemo();
            }
        }

        function exportarDados() {
            if (bizFlowApp) {
                bizFlowApp.exportarDados();
            }
        }
    </script>
</body>
</html>
