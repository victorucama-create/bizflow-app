<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizFlow - Sistema Empresarial FASE 4 COMPLETA</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üè¢</text></svg>">
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    
    <style>
        .auth-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 450px;
        }
        .app-container {
            display: none;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .empresa-selector {
            max-width: 200px;
        }
        .filial-badge {
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <!-- Container de Autentica√ß√£o -->
    <div class="auth-container">
        <div class="auth-card p-4">
            <div class="text-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-building me-2"></i>BizFlow
                </h1>
                <p class="text-muted">Sistema Empresarial - FASE 4 COMPLETA</p>
                <div class="badge bg-success">Multi-empresa ‚Ä¢ API ‚Ä¢ WebSocket</div>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="login-form">
                <div class="mb-3">
                    <label for="empresa" class="form-label">Empresa</label>
                    <select class="form-select" id="empresa">
                        <option value="1">Empresa Principal</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="username" class="form-label">Usu√°rio</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" 
                               placeholder="Digite seu usu√°rio" required
                               autocomplete="username">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                        <input type="password" class="form-control" id="password" 
                               placeholder="Digite sua senha" required
                               autocomplete="current-password">
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-sign-in-alt me-2"></i>Entrar no Sistema
                    </button>
                </div>
            </form>

            <div class="text-center mt-3">
                <small class="text-muted">
                    Usu√°rio demo: <strong>admin</strong> | Senha: <strong>admin123</strong>
                </small>
            </div>

            <div class="mt-4 p-3 bg-light rounded">
                <div id="system-status" class="text-center">
                    <span class="badge bg-warning">Verificando sistema FASE 4...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Container da Aplica√ß√£o -->
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-building me-2"></i> 
                    <strong>BizFlow</strong>
                    <small class="ms-2 opacity-75">FASE 4 EMPRESARIAL</small>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard">
                                <i class="fas fa-home me-1"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#vendas">
                                <i class="fas fa-shopping-cart me-1"></i> PDV
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#estoque">
                                <i class="fas fa-boxes me-1"></i> Estoque
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#financeiro">
                                <i class="fas fa-money-bill-wave me-1"></i> Financeiro
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#relatorios">
                                <i class="fas fa-chart-bar me-1"></i> Relat√≥rios
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-building me-1"></i> Empresarial
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#empresas">
                                    <i class="fas fa-building me-2"></i>Empresas
                                </a></li>
                                <li><a class="dropdown-item" href="#filiais">
                                    <i class="fas fa-store me-2"></i>Filiais
                                </a></li>
                                <li><a class="dropdown-item" href="#usuarios">
                                    <i class="fas fa-users me-2"></i>Usu√°rios
                                </a></li>
                                <li><a class="dropdown-item" href="#permissoes">
                                    <i class="fas fa-shield-alt me-2"></i>Permiss√µes
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#api">
                                    <i class="fas fa-code me-2"></i>API & Integra√ß√µes
                                </a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#backup">
                                <i class="fas fa-database me-1"></i> Backup
                            </a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <!-- Seletor de Empresa -->
                        <li class="nav-item dropdown me-2">
                            <a class="nav-link dropdown-toggle empresa-selector" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-building me-1"></i>
                                <span id="empresa-atual">Empresa</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="trocarEmpresa(1, 'Empresa Principal')">
                                    <i class="fas fa-check me-2 text-success"></i>Empresa Principal
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#empresaModal">
                                    <i class="fas fa-cog me-2"></i>Gerenciar Empresas
                                </a></li>
                            </ul>
                        </li>
                        
                        <!-- Notifica√ß√µes -->
                        <li class="nav-item dropdown me-2">
                            <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notification-count">0</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" style="min-width: 300px;">
                                <li><h6 class="dropdown-header">Notifica√ß√µes</h6></li>
                                <div id="notifications-list" style="max-height: 300px; overflow-y: auto;">
                                    <li class="px-3 py-2 text-muted text-center">Nenhuma notifica√ß√£o</li>
                                </div>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center" href="#" onclick="marcarTodasComoLidas()">
                                    Marcar todas como lidas
                                </a></li>
                            </ul>
                        </li>
                        
                        <li class="nav-item">
                            <span class="nav-link theme-switcher" onclick="alternarTema()">
                                <i class="fas fa-moon"></i>
                            </span>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i> <span id="user-name">Usu√°rio</span>
                                <small class="filial-badge badge bg-secondary ms-1" id="user-filial">MATRIZ</small>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#configModal">
                                    <i class="fas fa-cog me-2"></i>Configura√ß√µes
                                </a></li>
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#apiKeysModal">
                                    <i class="fas fa-key me-2"></i>API Keys
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" id="btn-logout">
                                    <i class="fas fa-sign-out-alt me-2"></i>Sair
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Dashboard Section -->
            <section id="dashboard" class="mb-5">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h2><i class="fas fa-tachometer-alt me-2"></i> Dashboard Empresarial</h2>
                            <div>
                                <span class="badge bg-success me-2" id="status-conexao">
                                    <i class="fas fa-circle me-1"></i> Online
                                </span>
                                <span class="badge bg-info" id="status-websocket">
                                    <i class="fas fa-plug me-1"></i> WebSocket
                                </span>
                            </div>
                        </div>
                        <p class="text-muted">Vis√£o completa do seu neg√≥cio - FASE 4 EMPRESARIAL</p>
                    </div>
                </div>

                <!-- Informa√ß√µes da Empresa -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body py-3">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h5 class="card-title mb-1" id="empresa-nome">Empresa Principal</h5>
                                        <p class="card-text text-muted mb-0" id="empresa-detalhes">
                                            <i class="fas fa-store me-1"></i>Filial: <strong id="filial-nome">Matriz</strong>
                                        </p>
                                    </div>
                                    <div class="col-md-6 text-md-end">
                                        <div class="btn-group">
                                            <button class="btn btn-outline-primary btn-sm" onclick="scrollToSection('empresas')">
                                                <i class="fas fa-building me-1"></i>Empresas
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="scrollToSection('filiais')">
                                                <i class="fas fa-store me-1"></i>Filiais
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- M√©tricas Principais FASE 4 -->
                <div class="row" id="dashboard-cards">
                    <!-- M√©tricas ser√£o carregadas via JavaScript -->
                </div>

                <!-- Se√ß√µes Empresariais FASE 4 -->
                <div class="row mt-4">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-building me-2"></i>Gest√£o Empresarial</h6>
                                <span class="badge bg-light text-primary" id="total-empresas">1</span>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-building fa-2x text-primary mb-2"></i>
                                            <h5 id="total-empresas-card">1</h5>
                                            <small class="text-muted">Empresas</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-store fa-2x text-success mb-2"></i>
                                            <h5 id="total-filiais">1</h5>
                                            <small class="text-muted">Filiais</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-users fa-2x text-warning mb-2"></i>
                                            <h5 id="total-usuarios">1</h5>
                                            <small class="text-muted">Usu√°rios</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-outline-primary w-100" onclick="scrollToSection('empresas')">
                                        <i class="fas fa-cog me-1"></i>Gerenciar Empresas
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-code me-2"></i>API & Integra√ß√µes</h6>
                                <span class="badge bg-light text-success" id="total-api-keys">0</span>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-success" onclick="scrollToSection('api')">
                                        <i class="fas fa-key me-1"></i>Gerenciar API Keys
                                    </button>
                                    <button class="btn btn-outline-info" onclick="bizFlowApp.testarWebSocket()">
                                        <i class="fas fa-plug me-1"></i>Testar WebSocket
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="bizFlowApp.carregarNotificacoes()">
                                        <i class="fas fa-bell me-1"></i>Ver Notifica√ß√µes
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="fas fa-info-circle me-2"></i>
                                            <strong>Sistema FASE 4:</strong> Multi-empresa, API REST, WebSocket, Notifica√ß√µes em tempo real
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Restante do dashboard (mantido da FASE 3) -->
                <!-- ... -->

            </section>

            <!-- Se√ß√µes Empresariais FASE 4 -->
            
            <!-- Se√ß√£o Empresas -->
            <section id="empresas" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-building me-2"></i>Gest√£o de Empresas</h3>
                        <p class="text-muted">Gerencie m√∫ltiplas empresas no sistema</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Empresa</h5>
                            </div>
                            <div class="card-body">
                                <form id="empresa-form">
                                    <div class="mb-3">
                                        <label for="empresa-nome" class="form-label">Nome da Empresa *</label>
                                        <input type="text" class="form-control" id="empresa-nome" 
                                               placeholder="Nome da empresa" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-cnpj" class="form-label">CNPJ</label>
                                        <input type="text" class="form-control" id="empresa-cnpj" 
                                               placeholder="00.000.000/0001-00">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="empresa-email" 
                                               placeholder="empresa@email.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="empresa-telefone" 
                                               placeholder="(11) 9999-9999">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-check me-1"></i> Cadastrar Empresa
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Empresas Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-empresas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-building fa-3x mb-3"></i>
                                        <p>Nenhuma empresa cadastrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o Filiais -->
            <section id="filiais" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-store me-2"></i>Gest√£o de Filiais</h3>
                        <p class="text-muted">Gerencie filiais/lojas da empresa</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Filial</h5>
                            </div>
                            <div class="card-body">
                                <form id="filial-form">
                                    <div class="mb-3">
                                        <label for="filial-nome" class="form-label">Nome da Filial *</label>
                                        <input type="text" class="form-control" id="filial-nome" 
                                               placeholder="Nome da filial/loja" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-codigo" class="form-label">C√≥digo *</label>
                                        <input type="text" class="form-control" id="filial-codigo" 
                                               placeholder="C√≥digo √∫nico (ex: MATRIZ, FILIAL01)" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-responsavel" class="form-label">Respons√°vel</label>
                                        <input type="text" class="form-control" id="filial-responsavel" 
                                               placeholder="Nome do respons√°vel">
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="filial-telefone" 
                                               placeholder="(11) 9999-9999">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-check me-1"></i> Cadastrar Filial
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Filiais Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-filiais" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-store fa-3x mb-3"></i>
                                        <p>Nenhuma filial cadastrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√£o API & Integra√ß√µes -->
            <section id="api" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-code me-2"></i>API & Integra√ß√µes</h3>
                        <p class="text-muted">Gerencie API Keys e integra√ß√µes externas</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-key me-1"></i>Gerar API Key</h5>
                            </div>
                            <div class="card-body">
                                <form id="api-key-form">
                                    <div class="mb-3">
                                        <label for="api-key-name" class="form-label">Nome da API Key *</label>
                                        <input type="text" class="form-control" id="api-key-name" 
                                               placeholder="Ex: Integra√ß√£o Site, App Mobile" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="api-key-permissions" class="form-label">Permiss√µes</label>
                                        <select class="form-select" id="api-key-permissions" multiple>
                                            <option value="products:read">Ler Produtos</option>
                                            <option value="products:write">Gerenciar Produtos</option>
                                            <option value="sales:read">Ler Vendas</option>
                                            <option value="sales:write">Criar Vendas</option>
                                            <option value="inventory:read">Ler Estoque</option>
                                        </select>
                                        <small class="text-muted">Segure Ctrl para selecionar m√∫ltiplas permiss√µes</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="api-key-expires" class="form-label">Expira em (dias)</label>
                                        <input type="number" class="form-control" id="api-key-expires" 
                                               placeholder="Deixe vazio para n√£o expirar" min="1">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-dark btn-lg">
                                            <i class="fas fa-key me-1"></i> Gerar API Key
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>API Keys Ativas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-api-keys" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-key fa-3x mb-3"></i>
                                        <p>Nenhuma API Key gerada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documenta√ß√£o da API -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-book me-1"></i>Documenta√ß√£o da API</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle me-2"></i>Autentica√ß√£o API</h6>
                                    <p>Todas as requisi√ß√µes devem incluir os headers:</p>
                                    <ul>
                                        <li><code>X-API-Key: sua_api_key</code></li>
                                        <li><code>X-Signature: assinatura_hmac</code></li>
                                        <li><code>X-Timestamp: timestamp_millis</code></li>
                                    </ul>
                                </div>
                                
                                <h6>Endpoints Dispon√≠veis:</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>M√©todo</th>
                                                <th>Endpoint</th>
                                                <th>Descri√ß√£o</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge bg-success">GET</span></td>
                                                <td><code>/api/v1/products</code></td>
                                                <td>Listar produtos</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">POST</span></td>
                                                <td><code>/api/v1/sales</code></td>
                                                <td>Criar nova venda</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">GET</span></td>
                                                <td><code>/api/v1/inventory</code></td>
                                                <td>Consultar estoque</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Se√ß√µes existentes da FASE 3 (mantidas) -->
            <!-- ... -->

        </div>

        <!-- Footer -->
        <footer class="bg-dark text-light py-4 mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="fas fa-building me-2"></i>BizFlow</h5>
                        <p class="mb-0">Sistema Empresarial - FASE 4 COMPLETA</p>
                        <small class="text-muted">Multi-empresa ‚Ä¢ Gest√£o de Filiais ‚Ä¢ API REST ‚Ä¢ WebSocket ‚Ä¢ Notifica√ß√µes</small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <i class="fas fa-code me-1"></i> 
                            Desenvolvido com 
                            <i class="fas fa-heart text-danger mx-1"></i>
                            para escalar seu neg√≥cio
                        </p>
                        <small class="text-muted">&copy; <span id="ano-atual">2024</span> BizFlow - Todos os direitos reservados</small>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modais FASE 4 -->
    
    <!-- Modal Empresas -->
    <div class="modal fade" id="empresaModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-building me-2"></i>Gerenciar Empresas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modal-lista-empresas">
                        <!-- Lista de empresas ser√° carregada aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal API Keys -->
    <div class="modal fade" id="apiKeysModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-key me-2"></i>Minhas API Keys</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modal-lista-api-keys">
                        <!-- Lista de API Keys ser√° carregada aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Configura√ß√µes (atualizado) -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-cog me-2"></i>Configura√ß√µes do Sistema</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="config-tema" class="form-label">Tema da Interface</label>
                        <select class="form-select" id="config-tema">
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                            <option value="auto">Autom√°tico</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-notificacoes" checked>
                            <label class="form-check-label" for="config-notificacoes">
                                Notifica√ß√µes do Sistema
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-websocket" checked>
                            <label class="form-check-label" for="config-websocket">
                                Conex√£o WebSocket
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-atualizacao" checked>
                            <label class="form-check-label" for="config-atualizacao">
                                Atualiza√ß√£o Autom√°tica
                            </label>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <small>
                            <i class="fas fa-info-circle me-2"></i>
                            As configura√ß√µes s√£o salvas automaticamente para seu usu√°rio.
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        // Sistema de Autentica√ß√£o FASE 4
        class AuthSystem {
            constructor() {
                this.token = localStorage.getItem('bizflow_token');
                this.user = JSON.parse(localStorage.getItem('bizflow_user') || 'null');
                this.empresaAtual = JSON.parse(localStorage.getItem('bizflow_empresa') || '{"id": 1, "nome": "Empresa Principal"}');
                this.socket = null;
                this.init();
            }

            init() {
                this.checkAuthStatus();
                this.setupEventListeners();
                this.checkSystemStatus();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Logout
                document.getElementById('btn-logout').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.handleLogout();
                });

                // Formul√°rios FASE 4
                const empresaForm = document.getElementById('empresa-form');
                if (empresaForm) {
                    empresaForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleNovaEmpresa();
                    });
                }

                const filialForm = document.getElementById('filial-form');
                if (filialForm) {
                    filialForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleNovaFilial();
                    });
                }

                const apiKeyForm = document.getElementById('api-key-form');
                if (apiKeyForm) {
                    apiKeyForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleNovaApiKey();
                    });
                }

                // Configura√ß√µes
                const websocketSwitch = document.getElementById('config-websocket');
                if (websocketSwitch) {
                    websocketSwitch.addEventListener('change', (e) => {
                        if (window.bizFlowApp) {
                            window.bizFlowApp.configuracoes.websocket = e.target.checked;
                            window.bizFlowApp.salvarConfiguracoes();
                            if (e.target.checked) {
                                window.bizFlowApp.conectarWebSocket();
                            } else {
                                window.bizFlowApp.desconectarWebSocket();
                            }
                        }
                    });
                }
            }

            async handleLogin() {
                const form = document.getElementById('login-form');
                const empresaId = document.getElementById('empresa').value;
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (!username || !password) {
                    this.showAlert('Preencha todos os campos!', 'warning');
                    return;
                }

                this.showLoading(form, 'Entrando...');

                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ 
                            username, 
                            password, 
                            empresa_id: empresaId 
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.token = data.data.session_token;
                        this.user = data.data.user;
                        this.empresaAtual = {
                            id: data.data.user.empresa_id,
                            nome: data.data.user.empresa_nome
                        };
                        
                        localStorage.setItem('bizflow_token', this.token);
                        localStorage.setItem('bizflow_user', JSON.stringify(this.user));
                        localStorage.setItem('bizflow_empresa', JSON.stringify(this.empresaAtual));
                        
                        this.showApp();
                        this.showAlert('Login FASE 4 realizado com sucesso! üè¢', 'success');
                    } else {
                        throw new Error(data.error || 'Erro no login');
                    }
                } catch (error) {
                    this.showAlert(error.message, 'danger');
                } finally {
                    this.hideLoading(form, 'Entrar no Sistema');
                }
            }

            showApp() {
                document.querySelector('.auth-container').style.display = 'none';
                document.querySelector('.app-container').style.display = 'block';
                
                // Atualizar interface FASE 4
                document.getElementById('user-name').textContent = this.user.full_name;
                document.getElementById('empresa-atual').textContent = this.empresaAtual.nome;
                document.getElementById('empresa-nome').textContent = this.empresaAtual.nome;
                document.getElementById('user-filial').textContent = this.user.filial_nome || 'MATRIZ';
                document.getElementById('filial-nome').textContent = this.user.filial_nome || 'Matriz';
                
                // Inicializar BizFlow App FASE 4
                if (window.bizFlowApp) {
                    window.bizFlowApp.setAuthToken(this.token);
                    window.bizFlowApp.setEmpresaAtual(this.empresaAtual);
                    window.bizFlowApp.init();
                }
                
                // Carregar dados FASE 4
                this.carregarEmpresas();
                this.carregarFiliais();
                this.carregarApiKeys();
                this.carregarDashboardAvancado();
                
                // Configurar tema
                if (window.bizFlowApp.configuracoes.tema === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    document.body.setAttribute('data-bs-theme', prefersDark ? 'dark' : 'light');
                }
            }

            async carregarEmpresas() {
                try {
                    const response = await fetch('/api/empresas', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    const data = await response.json();

                    if (data.success && window.bizFlowApp) {
                        window.bizFlowApp.exibirEmpresas(data.data);
                    }
                } catch (error) {
                    console.error('Erro ao carregar empresas:', error);
                }
            }

            async carregarFiliais() {
                try {
                    const response = await fetch('/api/filiais', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    const data = await response.json();

                    if (data.success && window.bizFlowApp) {
                        window.bizFlowApp.exibirFiliais(data.data);
                    }
                } catch (error) {
                    console.error('Erro ao carregar filiais:', error);
                }
            }

            async carregarApiKeys() {
                try {
                    // Implementar carregamento de API Keys
                    if (window.bizFlowApp) {
                        window.bizFlowApp.carregarApiKeys();
                    }
                } catch (error) {
                    console.error('Erro ao carregar API Keys:', error);
                }
            }

            // ... (outros m√©todos mantidos)

        }

        // Fun√ß√µes globais FASE 4
        function trocarEmpresa(empresaId, empresaNome) {
            if (window.authSystem) {
                window.authSystem.empresaAtual = { id: empresaId, nome: empresaNome };
                localStorage.setItem('bizflow_empresa', JSON.stringify(window.authSystem.empresaAtual));
                
                document.getElementById('empresa-atual').textContent = empresaNome;
                document.getElementById('empresa-nome').textContent = empresaNome;
                
                window.authSystem.showAlert(`Empresa alterada para: ${empresaNome}`, 'info');
                
                // Recarregar dados da nova empresa
                if (window.bizFlowApp) {
                    window.bizFlowApp.carregarDadosEmpresa();
                }
            }
        }

        function marcarTodasComoLidas() {
            if (window.bizFlowApp) {
                window.bizFlowApp.marcarTodasNotificacoesComoLidas();
            }
        }

        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            window.authSystem = new AuthSystem();
            document.getElementById('ano-atual').textContent = new Date().getFullYear();
        });
    </script>

    <!-- Incluir o app.js da FASE 4 -->
    <script src="/js/app.js"></script>
</body>
</html>
