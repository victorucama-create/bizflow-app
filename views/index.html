<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizFlow - Sistema Empresarial FASE 5.1 PRODUﾃﾃグ</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>召</text></svg>">
    
    <!-- 笨 CDNs OTIMIZADAS PARA PRODUﾃﾃグ FASE 5.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    
    <style>
        .auth-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 450px;
        }
        .app-container {
            display: none;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .empresa-selector {
            max-width: 200px;
        }
        .filial-badge {
            font-size: 0.75rem;
        }
        .status-online { color: #198754; }
        .status-offline { color: #dc3545; }
        .status-degraded { color: #ffc107; }
        .websocket-connected { color: #198754; }
        .websocket-disconnected { color: #6c757d; }
        .websocket-connecting { color: #ffc107; }
        .websocket-error { color: #dc3545; }
        
        /* 笨 NOVOS ESTILOS FASE 5.1 */
        .performance-badge {
            font-size: 0.7rem;
        }
        .cache-indicator {
            font-size: 0.8rem;
        }
        .toast-container {
            z-index: 9999;
        }
        .connection-status, .websocket-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Container de Autenticaﾃｧﾃ｣o -->
    <div class="auth-container">
        <div class="auth-card p-4">
            <div class="text-center mb-4">
                <h1 class="text-primary">
                    <i class="fas fa-building me-2"></i>BizFlow
                </h1>
                <p class="text-muted">Sistema Empresarial - FASE 5.1 PRODUﾃﾃグ</p>
                <div class="badge bg-success">Sistema de Produﾃｧﾃ｣o 窶｢ Otimizado 窶｢ Monitorado</div>
            </div>

            <!-- Formulﾃ｡rio de Login SIMPLIFICADO -->
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Usuﾃ｡rio</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" 
                               placeholder="Digite seu usuﾃ｡rio" required
                               autocomplete="username" value="admin">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                        <input type="password" class="form-control" id="password" 
                               placeholder="Digite sua senha" required
                               autocomplete="current-password" value="admin123">
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-sign-in-alt me-2"></i>Entrar no Sistema
                    </button>
                </div>
            </form>

            <div class="text-center mt-3">
                <small class="text-muted">
                    Usuﾃ｡rio: <strong>admin</strong> | Senha: <strong>admin123</strong>
                </small>
            </div>

            <div class="mt-4 p-3 bg-light rounded">
                <div id="system-status" class="text-center">
                    <span class="badge bg-warning">Verificando sistema FASE 5.1...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Container da Aplicaﾃｧﾃ｣o -->
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-building me-2"></i> 
                    <strong>BizFlow</strong>
                    <small class="ms-2 opacity-75">FASE 5.1 PRODUﾃﾃグ</small>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard">
                                <i class="fas fa-home me-1"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#vendas">
                                <i class="fas fa-shopping-cart me-1"></i> PDV
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#estoque">
                                <i class="fas fa-boxes me-1"></i> Estoque
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#financeiro">
                                <i class="fas fa-money-bill-wave me-1"></i> Financeiro
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#relatorios">
                                <i class="fas fa-chart-bar me-1"></i> Relatﾃｳrios
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-building me-1"></i> Empresarial
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#empresas">
                                    <i class="fas fa-building me-2"></i>Empresas
                                </a></li>
                                <li><a class="dropdown-item" href="#filiais">
                                    <i class="fas fa-store me-2"></i>Filiais
                                </a></li>
                                <li><a class="dropdown-item" href="#usuarios">
                                    <i class="fas fa-users me-2"></i>Usuﾃ｡rios
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#api">
                                    <i class="fas fa-code me-2"></i>API & Integraﾃｧﾃｵes
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <!-- 笨 STATUS DE CONEXﾃグ FASE 5.1 -->
                        <li class="nav-item me-2">
                            <span class="nav-link">
                                <span id="status-conexao" class="connection-status status-online">
                                    <i class="fas fa-wifi me-1"></i>Online
                                </span>
                            </span>
                        </li>
                        
                        <li class="nav-item me-2">
                            <span class="nav-link">
                                <span id="status-websocket" class="websocket-status websocket-disconnected">
                                    <i class="fas fa-plug me-1"></i>WebSocket
                                </span>
                            </span>
                        </li>
                        
                        <!-- Notificaﾃｧﾃｵes -->
                        <li class="nav-item dropdown me-2">
                            <a class="nav-link position-relative" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge d-none" id="notification-count">0</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" style="min-width: 300px;">
                                <li><h6 class="dropdown-header">Notificaﾃｧﾃｵes</h6></li>
                                <div id="notifications-list" style="max-height: 300px; overflow-y: auto;">
                                    <li class="px-3 py-2 text-muted text-center">Nenhuma notificaﾃｧﾃ｣o</li>
                                </div>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center" href="#" onclick="marcarTodasComoLidas()">
                                    Marcar todas como lidas
                                </a></li>
                            </ul>
                        </li>
                        
                        <li class="nav-item">
                            <span class="nav-link theme-switcher" onclick="alternarTema()">
                                <i class="fas fa-moon"></i>
                            </span>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i> <span id="user-name">Usuﾃ｡rio</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#configModal">
                                    <i class="fas fa-cog me-2"></i>Configuraﾃｧﾃｵes FASE 5.1
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" id="btn-logout">
                                    <i class="fas fa-sign-out-alt me-2"></i>Sair
                                </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Dashboard Section FASE 5.1 -->
            <section id="dashboard" class="mb-5">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h2><i class="fas fa-tachometer-alt me-2"></i> Dashboard FASE 5.1</h2>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="testarConexoes()">
                                    <i class="fas fa-network-wired me-1"></i>Testar Conexﾃｵes
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="limparCache()">
                                    <i class="fas fa-broom me-1"></i>Limpar Cache
                                </button>
                            </div>
                        </div>
                        <p class="text-muted">Sistema de Produﾃｧﾃ｣o - Monitorado e Otimizado</p>
                    </div>
                </div>

                <!-- 笨 NOVAS Mﾃ欝RICAS FASE 5.1 -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-3 mb-3">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-rocket fa-2x text-primary mb-2"></i>
                                            <h5 id="metric-requests">0</h5>
                                            <small class="text-muted">Requisiﾃｧﾃｵes/min</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-bolt fa-2x text-success mb-2"></i>
                                            <h5 id="metric-cache">0</h5>
                                            <small class="text-muted">Cache Hits</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-shield-alt fa-2x text-warning mb-2"></i>
                                            <h5 id="metric-errors">0</h5>
                                            <small class="text-muted">Erros</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-clock fa-2x text-info mb-2"></i>
                                            <h5 id="metric-response">0ms</h5>
                                            <small class="text-muted">Tempo Resposta</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seﾃｧﾃｵes Empresariais FASE 5.1 -->
                <div class="row mt-4">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-building me-2"></i>Gestﾃ｣o Empresarial</h6>
                                <span class="badge bg-light text-primary" id="total-empresas">1</span>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-building fa-2x text-primary mb-2"></i>
                                            <h5 id="total-empresas-card">1</h5>
                                            <small class="text-muted">Empresas</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-store fa-2x text-success mb-2"></i>
                                            <h5 id="total-filiais">1</h5>
                                            <small class="text-muted">Filiais</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="border rounded p-3">
                                            <i class="fas fa-users fa-2x text-warning mb-2"></i>
                                            <h5 id="total-usuarios">1</h5>
                                            <small class="text-muted">Usuﾃ｡rios</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-outline-primary w-100" onclick="scrollToSection('empresas')">
                                        <i class="fas fa-cog me-1"></i>Gerenciar Empresas
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-code me-2"></i>Sistema FASE 5.1</h6>
                                <span class="badge bg-light text-success">PRODUﾃﾃグ</span>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-success" onclick="bizFlowApp.testarWebSocket()">
                                        <i class="fas fa-plug me-1"></i>Testar WebSocket
                                    </button>
                                    <button class="btn btn-outline-info" onclick="bizFlowApp.testarConexaoCompleta()">
                                        <i class="fas fa-network-wired me-1"></i>Teste Completo
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="limparCache()">
                                        <i class="fas fa-broom me-1"></i>Limpar Cache
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <div class="alert alert-success">
                                        <small>
                                            <i class="fas fa-check-circle me-2"></i>
                                            <strong>Sistema FASE 5.1:</strong> Produﾃｧﾃ｣o 窶｢ Cache 窶｢ Monitoramento 窶｢ Performance
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aﾃｧﾃｵes Rﾃ｡pidas -->
                <div class="row mt-3">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-credit-card me-2"></i>Mﾃｩtodos de Pagamento</h6>
                            </div>
                            <div class="card-body">
                                <div id="metodos-pagamento">
                                    <p class="text-muted text-center">Carregando...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Aﾃｧﾃｵes Rﾃ｡pidas</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <button class="btn btn-outline-primary w-100" onclick="scrollToSection('vendas')">
                                            <i class="fas fa-cash-register me-1"></i>Venda
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-outline-success w-100" onclick="scrollToSection('estoque')">
                                            <i class="fas fa-plus me-1"></i>Estoque
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-outline-info w-100" onclick="scrollToSection('financeiro')">
                                            <i class="fas fa-money-bill me-1"></i>Financeiro
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-outline-warning w-100" onclick="scrollToSection('relatorios')">
                                            <i class="fas fa-chart-bar me-1"></i>Relatﾃｳrios
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button class="btn btn-outline-dark w-100" onclick="carregarDashboard()">
                                            <i class="fas fa-sync me-1"></i>Atualizar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seﾃｧﾃｵes Empresariais FASE 5.1 -->
            
            <!-- Seﾃｧﾃ｣o Empresas -->
            <section id="empresas" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-building me-2"></i>Gestﾃ｣o de Empresas</h3>
                        <p class="text-muted">Gerencie mﾃｺltiplas empresas no sistema</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Empresa</h5>
                            </div>
                            <div class="card-body">
                                <form id="empresa-form">
                                    <div class="mb-3">
                                        <label for="empresa-nome" class="form-label">Nome da Empresa *</label>
                                        <input type="text" class="form-control" id="empresa-nome" 
                                               placeholder="Nome da empresa" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-cnpj" class="form-label">CNPJ</label>
                                        <input type="text" class="form-control" id="empresa-cnpj" 
                                               placeholder="00.000.000/0001-00">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="empresa-email" 
                                               placeholder="empresa@email.com">
                                    </div>
                                    <div class="mb-3">
                                        <label for="empresa-telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="empresa-telefone" 
                                               placeholder="(11) 9999-9999">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-check me-1"></i> Cadastrar Empresa
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Empresas Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-empresas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-building fa-3x mb-3"></i>
                                        <p>Nenhuma empresa cadastrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seﾃｧﾃ｣o Filiais -->
            <section id="filiais" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-store me-2"></i>Gestﾃ｣o de Filiais</h3>
                        <p class="text-muted">Gerencie filiais/lojas da empresa</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Filial</h5>
                            </div>
                            <div class="card-body">
                                <form id="filial-form">
                                    <div class="mb-3">
                                        <label for="filial-nome" class="form-label">Nome da Filial *</label>
                                        <input type="text" class="form-control" id="filial-nome" 
                                               placeholder="Nome da filial/loja" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-codigo" class="form-label">Cﾃｳdigo *</label>
                                        <input type="text" class="form-control" id="filial-codigo" 
                                               placeholder="Cﾃｳdigo ﾃｺnico (ex: MATRIZ, FILIAL01)" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-responsavel" class="form-label">Responsﾃ｡vel</label>
                                        <input type="text" class="form-control" id="filial-responsavel" 
                                               placeholder="Nome do responsﾃ｡vel">
                                    </div>
                                    <div class="mb-3">
                                        <label for="filial-telefone" class="form-label">Telefone</label>
                                        <input type="text" class="form-control" id="filial-telefone" 
                                               placeholder="(11) 9999-9999">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-check me-1"></i> Cadastrar Filial
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Filiais Cadastradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-filiais" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-store fa-3x mb-3"></i>
                                        <p>Nenhuma filial cadastrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seﾃｧﾃ｣o API & Integraﾃｧﾃｵes -->
            <section id="api" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-code me-2"></i>API & Integraﾃｧﾃｵes</h3>
                        <p class="text-muted">Gerencie API Keys e integraﾃｧﾃｵes externas</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-key me-1"></i>Gerar API Key</h5>
                            </div>
                            <div class="card-body">
                                <form id="api-key-form">
                                    <div class="mb-3">
                                        <label for="api-key-name" class="form-label">Nome da API Key *</label>
                                        <input type="text" class="form-control" id="api-key-name" 
                                               placeholder="Ex: Integraﾃｧﾃ｣o Site, App Mobile" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="api-key-permissions" class="form-label">Permissﾃｵes</label>
                                        <select class="form-select" id="api-key-permissions" multiple>
                                            <option value="products:read">Ler Produtos</option>
                                            <option value="products:write">Gerenciar Produtos</option>
                                            <option value="sales:read">Ler Vendas</option>
                                            <option value="sales:write">Criar Vendas</option>
                                            <option value="inventory:read">Ler Estoque</option>
                                        </select>
                                        <small class="text-muted">Segure Ctrl para selecionar mﾃｺltiplas permissﾃｵes</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="api-key-expires" class="form-label">Expira em (dias)</label>
                                        <input type="number" class="form-control" id="api-key-expires" 
                                               placeholder="Deixe vazio para nﾃ｣o expirar" min="1">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-dark btn-lg">
                                            <i class="fas fa-key me-1"></i> Gerar API Key
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>API Keys Ativas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-api-keys" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-key fa-3x mb-3"></i>
                                        <p>Nenhuma API Key gerada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seﾃｧﾃｵes existentes da FASE 3 (mantidas) -->
            <!-- PDV Section -->
            <section id="vendas" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-cash-register me-2"></i>Ponto de Venda</h3>
                        <p class="text-muted">Registre vendas rapidamente</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-plus-circle me-1"></i>Nova Venda</h5>
                            </div>
                            <div class="card-body">
                                <form id="venda-form">
                                    <div class="mb-3">
                                        <label for="produto" class="form-label">Produto *</label>
                                        <input type="text" class="form-control" id="produto" 
                                               placeholder="Nome do produto" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="valor" class="form-label">Valor (R$) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">R$</span>
                                            <input type="number" class="form-control" id="valor" 
                                                   step="0.01" min="0.01" placeholder="0,00" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="quantidade-venda" class="form-label">Quantidade</label>
                                        <input type="number" class="form-control" id="quantidade-venda" 
                                               value="1" min="1">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-check me-1"></i> Registrar Venda
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-history me-1"></i>ﾃ嗟timas Vendas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-vendas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-receipt fa-3x mb-3"></i>
                                        <p>Nenhuma venda registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="estoque" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-boxes me-2"></i>Gestﾃ｣o de Estoque</h3>
                        <p class="text-muted">Controle seus produtos</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-plus me-1"></i>Adicionar Produto</h5>
                            </div>
                            <div class="card-body">
                                <form id="estoque-form">
                                    <div class="mb-3">
                                        <label for="produto-estoque" class="form-label">Nome do Produto *</label>
                                        <input type="text" class="form-control" id="produto-estoque" 
                                               placeholder="Nome do produto" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="preco" class="form-label">Preﾃｧo (R$) *</label>
                                        <input type="number" class="form-control" id="preco" 
                                               step="0.01" min="0.01" placeholder="0,00" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="quantidade" class="form-label">Quantidade *</label>
                                        <input type="number" class="form-control" id="quantidade" 
                                               min="0" value="0" required>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-save me-1"></i> Adicionar Produto
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-clipboard-list me-1"></i>Produtos em Estoque</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-estoque" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-box-open fa-3x mb-3"></i>
                                        <p>Nenhum produto cadastrado</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Financeiro Section -->
            <section id="financeiro" class="mb-5">
                <div class="row">
                    <div class="col-12">
                        <h3 class="nav-section"><i class="fas fa-money-bill-wave me-2"></i>Gestﾃ｣o Financeira</h3>
                        <p class="text-muted">Controle de contas a pagar e receber</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-1"></i>Nova Conta</h5>
                            </div>
                            <div class="card-body">
                                <form id="financeiro-form">
                                    <div class="mb-3">
                                        <label for="conta-nome" class="form-label">Descriﾃｧﾃ｣o *</label>
                                        <input type="text" class="form-control" id="conta-nome" 
                                               placeholder="Ex: Venda cliente, Pagamento fornecedor" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-tipo" class="form-label">Tipo *</label>
                                        <select class="form-select" id="conta-tipo" required>
                                            <option value="receita">Receita</option>
                                            <option value="despesa">Despesa</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-valor" class="form-label">Valor (R$) *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">R$</span>
                                            <input type="number" class="form-control" id="conta-valor" 
                                                   step="0.01" min="0.01" placeholder="0,00" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="conta-vencimento" class="form-label">Data de Vencimento *</label>
                                        <input type="date" class="form-control" id="conta-vencimento" required>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-info btn-lg">
                                            <i class="fas fa-check me-1"></i> Registrar Conta
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-list me-1"></i>Contas Registradas</h5>
                            </div>
                            <div class="card-body">
                                <div id="lista-contas" style="max-height: 400px; overflow-y: auto;">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-file-invoice-dollar fa-3x mb-3"></i>
                                        <p>Nenhuma conta registrada</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="bg-dark text-light py-4 mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="fas fa-building me-2"></i>BizFlow</h5>
                        <p class="mb-0">Sistema Empresarial - FASE 5.1 PRODUﾃﾃグ</p>
                        <small class="text-muted">Sistema de Produﾃｧﾃ｣o 窶｢ Cache 窶｢ Monitoramento 窶｢ Performance</small>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <i class="fas fa-code me-1"></i> 
                            Desenvolvido com 
                            <i class="fas fa-heart text-danger mx-1"></i>
                            para escalar seu negﾃｳcio
                        </p>
                        <small class="text-muted">&copy; <span id="ano-atual">2024</span> BizFlow - FASE 5.1</small>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- 笨 MODAL CONFIGURAﾃﾃ髭S FASE 5.1 -->
    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-cog me-2"></i>Configuraﾃｧﾃｵes FASE 5.1</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="config-tema" class="form-label">Tema da Interface</label>
                        <select class="form-select" id="config-tema">
                            <option value="light">Claro</option>
                            <option value="dark">Escuro</option>
                            <option value="auto">Automﾃ｡tico</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-websocket" checked>
                            <label class="form-check-label" for="config-websocket">
                                Conexﾃ｣o WebSocket
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-cache" checked>
                            <label class="form-check-label" for="config-cache">
                                Sistema de Cache
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="config-retry" checked>
                            <label class="form-check-label" for="config-retry">
                                Retry Automﾃ｡tico
                            </label>
                        </div>
                    </div>
                    <div class="alert alert-info">
                        <small>
                            <i class="fas fa-info-circle me-2"></i>
                            Configuraﾃｧﾃｵes otimizadas para produﾃｧﾃ｣o FASE 5.1
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="aplicarConfiguracoes()">Aplicar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- 笨 SISTEMA DE AUTENTICAﾃﾃグ SIMPLIFICADO FASE 5.1 -->
    <script>
        class AuthSystem {
            constructor() {
                this.token = localStorage.getItem('bizflow_token');
                this.user = JSON.parse(localStorage.getItem('bizflow_user') || 'null');
                this.init();
            }

            init() {
                this.checkAuthStatus();
                this.setupEventListeners();
                this.checkSystemStatus();
            }

            setupEventListeners() {
                // Login form
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                // Logout
                document.getElementById('btn-logout').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.handleLogout();
                });
            }

            async checkAuthStatus() {
                if (this.token && this.user) {
                    this.showApp();
                } else {
                    this.showLogin();
                }
            }

            async checkSystemStatus() {
                try {
                    const response = await fetch('/health');
                    const data = await response.json();
                    
                    if (data.status === 'OK') {
                        document.getElementById('system-status').innerHTML = 
                            '<span class="badge bg-success">Sistema Online - FASE 5.1</span>';
                    } else {
                        document.getElementById('system-status').innerHTML = 
                            '<span class="badge bg-danger">Sistema Offline</span>';
                    }
                } catch (error) {
                    document.getElementById('system-status').innerHTML = 
                        '<span class="badge bg-warning">Verificando...</span>';
                }
            }

            async handleLogin() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (!username || !password) {
                    this.showAlert('Preencha todos os campos!', 'warning');
                    return;
                }

                this.showLoading('Entrando...');

                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.token = data.data.session_token;
                        this.user = data.data.user;
                        
                        localStorage.setItem('bizflow_token', this.token);
                        localStorage.setItem('bizflow_user', JSON.stringify(this.user));
                        
                        this.showApp();
                        this.showAlert('Login FASE 5.1 realizado com sucesso! 噫', 'success');
                    } else {
                        throw new Error(data.error || 'Erro no login');
                    }
                } catch (error) {
                    this.showAlert(error.message, 'danger');
                } finally {
                    this.hideLoading();
                }
            }

            async handleLogout() {
                this.clearAuth();
                this.showLogin();
                this.showAlert('Logout realizado com sucesso!', 'info');
            }

            showApp() {
                document.querySelector('.auth-container').style.display = 'none';
                document.querySelector('.app-container').style.display = 'block';
                
                // Atualizar interface
                document.getElementById('user-name').textContent = this.user?.full_name || 'Usuﾃ｡rio';
                
                // Inicializar BizFlow App FASE 5.1
                if (window.bizFlowApp) {
                    window.bizFlowApp.setAuthToken(this.token);
                    window.bizFlowApp.init();
                }
            }

            showLogin() {
                document.querySelector('.auth-container').style.display = 'flex';
                document.querySelector('.app-container').style.display = 'none';
            }

            clearAuth() {
                this.token = null;
                this.user = null;
                localStorage.removeItem('bizflow_token');
                localStorage.removeItem('bizflow_user');
            }

            showAlert(message, type = 'info') {
                // Implementaﾃｧﾃ｣o simples de alerta
                alert(`[${type.toUpperCase()}] ${message}`);
            }

            showLoading(text) {
                const button = document.querySelector('#login-form button[type="submit"]');
                button.disabled = true;
                button.innerHTML = `<i class="fas fa-spinner fa-spin me-2"></i>${text}`;
            }

            hideLoading() {
                const button = document.querySelector('#login-form button[type="submit"]');
                button.disabled = false;
                button.innerHTML = `<i class="fas fa-sign-in-alt me-2"></i>Entrar no Sistema`;
            }
        }

        // 笨 FUNﾃﾃ髭S GLOBAIS FASE 5.1
        function testarConexoes() {
            if (window.bizFlowApp) {
                window.bizFlowApp.testarConexaoCompleta();
            }
        }

        function limparCache() {
            if (window.bizFlowApp) {
                window.bizFlowApp.invalidarCache();
                window.bizFlowApp.mostrarAlerta('Cache limpo com sucesso!', 'success');
            }
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function carregarDashboard() {
            if (window.bizFlowApp) {
                window.bizFlowApp.carregarDadosIniciaisFase5();
            }
        }

        function alternarTema() {
            const body = document.body;
            const temaAtual = body.getAttribute('data-bs-theme');
            const novoTema = temaAtual === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-bs-theme', novoTema);
        }

        function aplicarConfiguracoes() {
            if (window.bizFlowApp) {
                const websocket = document.getElementById('config-websocket').checked;
                const cache = document.getElementById('config-cache').checked;
                const retry = document.getElementById('config-retry').checked;
                const tema = document.getElementById('config-tema').value;
                
                window.bizFlowApp.configuracoes.websocket = websocket;
                window.bizFlowApp.configuracoes.cache = cache;
                window.bizFlowApp.configuracoes.retryAuto = retry;
                window.bizFlowApp.configuracoes.tema = tema;
                
                window.bizFlowApp.salvarConfiguracoes();
                window.bizFlowApp.aplicarConfiguracoes();
                
                // Fechar modal
                bootstrap.Modal.getInstance(document.getElementById('configModal')).hide();
                
                window.bizFlowApp.mostrarAlerta('Configuraﾃｧﾃｵes aplicadas!', 'success');
            }
        }

        function marcarTodasComoLidas() {
            if (window.bizFlowApp) {
                window.bizFlowApp.marcarTodasNotificacoesComoLidas();
            }
        }

        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', function() {
            window.authSystem = new AuthSystem();
            document.getElementById('ano-atual').textContent = new Date().getFullYear();
        });
    </script>

    <!-- 笨 INCLUIR O APP.JS DA FASE 5.1 -->
    <script src="/js/app.js"></script>
</body>
</html>
